---
layout: post
title: Java类初始化过程
---

### 一个类初始化的3个步骤

#### step1 类加载

加载（Loading），由类加载器执行，查找字节码，并创建一个Class对象（只是创建）；

#### step2 链接

链接（Linking），验证字节码，为静态域分配存储空间（只是分配，并不初始化该存储空间），解析该类创建所需要的对其它类的应用；

#### step3 初始化

初始化（Initialization），**首先执行静态初始化块static{}，初始化静态变量，执行静态方法（如构造方法）**。


### 触发类初始化的6种场景

根据java虚拟机规范，所有java虚拟机必须在每个类或接口被java程序**首次主动使用时才初始化类**。

主动使用有以下6种：

1)	创建类的实例

2)	访问某个类或者接口的静态变量，或者对该静态变量赋值（如果访问静态编译时常量(即编译时可以确定值的常量)不会导致类的初始化）

```
public class Person(){
	// max就是编译时常量（必须同时满足static && final && 常量）
	// 可以直接使用Person.maxAge，而不触发类初始化
	private static final int maxAge = 120;
}
```

3)	调用类的静态方法

4)	反射（Class.forName(xxx.xxx.xxx)）

5)	初始化一个类的子类（相当于对父类的主动使用），不过直接通过子类引用父类元素，不会引起子类的初始化（参见示例6）

6)	Java虚拟机被标明为启动类的类（包含main方法的）

类与接口的初始化不同，如果一个类被初始化，则其父类或父接口也会被初始化，但如果一个接口初始化，则不会引起其父接口的初始化。
